

// ------------------------------------------------
// create array with objects for each question
// ------------------------------------------------

var questionArray = [



{
    question: "",
    rightAnswer: "Sting",
    allAnswers: [
        "Sting",
        "Flea",
        "Punch",
        "Thundercat",
    ],
    image: "assets/images/sting.jpg",
    audioFile: "assets/sound/the_police.mp3",
    band: "The Police",
},

{
    question: "",
    rightAnswer: "James Jamerson",
    allAnswers: [
        "James Jamerson",
        "Robert Trujillo",
        "Bob Babbit",
        "Bob Bogle",
    ],
    image: "assets/images/james_jamerson.jpg",
    audioFile: "assets/sound/marvin.mp3",
    band: "Funk Brothers",
},

{
    question: "",
    rightAnswer: "Paul McCartney",
    allAnswers: [
        "Paul McCartney",
        "Victor Wooten",
        "Doug Wimbish",
        "Colin Greenwood",
    ],
    image: "assets/images/paul_mccartney.jpg",
    audioFile: "assets/sound/the_beatles.mp3",
    band: "The Beatles",
},

{
    question: "",
    rightAnswer: "Phil Lynott",
    allAnswers: [
        "Phil Lynott",
        "Victor Bailey",
        "Michael Manring",
        "Michael Shuman",
    ],
    image: "assets/images/phil_lynott.jpg",
    audioFile: "assets/sound/thin_lizzy.mp3",
    band: "Thin Lizzy",
},

{
    question: "",
    rightAnswer: "Bootsy Collins",
    allAnswers: [
        "Bootsy Collins",
        "Chris Squire",
        "Dee Murray",
        "Michael Ivins",
    ],
    image: "assets/images/bootsy_collins.jpg",
    audioFile: "assets/sound/parliament.mp3",
    band: "Parliament-Funkadelic",
},

{
    question: "",
    rightAnswer: "John Paul Jones",
    allAnswers: [
        "John Paul Jones",
        "Jack Bruce",
        "Jonas Hellborg",
        "Nick Oliveri",
    ],
    image: "assets/images/john_paul_jones.jpg",
    audioFile: "assets/sound/zeppelin.mp3",
    band: "Led Zeppelin",
},

{
    question: "",
    rightAnswer: "Lemmy Kilmister",
    allAnswers: [
        "Lemmy Kilmister",
        "Geezer Butler",
        "Bill Black",
        "Roger Waters",
    ],
    image: "assets/images/lemmy_kilmister.jpg",
    audioFile: "assets/sound/motorhead.mp3",
    band: "Motorhead",
},

{
    question: "",
    rightAnswer: "Steve Harris",
    allAnswers: [
        "Steve Harris",
        "John Deacon",
        "Bobby Vega",
        "Armistead Burwell Smith IV",
    ],
    image: "assets/images/steve_harris.jpg",
    audioFile: "assets/sound/iron_maiden.mp3",
    band: "Iron Maiden",
},

{
    question: "",
    rightAnswer: "Peter Hook",
    allAnswers: [
        "Peter Hook",
        "Donald Dunn",
        "Jeff Berlin",
        "Troy Sanders",
    ],
    image: "assets/images/peter_hook.jpg",
    audioFile: "assets/sound/new_order.mp3",
    band: "Joy Division & New Order",
},

{
    question: "",
    rightAnswer: "Cliff Burton",
    allAnswers: [
        "Cliff Burton",
        "Billy Sheehan",
        "Berry Oakley",
        "Mick Karn",
    ],
    image: "assets/images/cliff_burton.jpg",
    audioFile: "assets/sound/metallica.mp3",
    band: "Metallica",
},

{
    question: "",
    rightAnswer: "Geddy Lee",
    allAnswers: [
        "Geddy Lee",
        "Tony Levin",
        "Les Claypool",
        "Joe Osborn",
    ],
    image: "assets/images/geddy_lee.jpg",
    audioFile: "assets/sound/rush.mp3",
    band: "Rush",
},

{
    question: "",
    rightAnswer: "Flea",
    allAnswers: [
        "Flea",
        "Lice",
        "Tick",
        "Ant",
    ],
    image: "assets/images/flea.jpg",
    audioFile: "assets/sound/rhcp.mp3",
    band: "Red Hot Chili Peppers"
},

{
    question: "",
    rightAnswer: "Jaco Pastorius",
    allAnswers: [
        "Jaco Pastorius",
        "Bernand Edwards",
        "Verdine White",
        "Robert DeLeo",
    ],
    image: "assets/images/jaco_pastorius.jpg",
    audioFile: "assets/sound/jaco.mp3",
    band: "Weather Report, Etc.",
},

{
    question: "",
    rightAnswer: "Krist Novoselic",
    allAnswers: [
        "Krist Novoselic",
        "Pino Palladino",
        "Will Lee",
        "Brian Ritchie",
    ],
    image: "assets/images/krist_novoselic.jpg",
    audioFile: "assets/sound/nirvana.mp3",
    band: "Nirvana",
},

{
    question: "",
    rightAnswer: "Larry Graham",
    allAnswers: [
        "Larry Graham",
        "Stu Hamm",
        "Jack Cassidy",
        "Robert Been",
    ],
    image: "assets/images/larry_graham.jpg",
    audioFile: "assets/sound/family_stone.mp3",
    band: "Sly and the Family Stone",
},

{
    question: "",
    rightAnswer: "John Entwistle",
    allAnswers: [
        "John Entwistle",
        "Nathan East",
        "John Patitucci",
        "Timothy Schmit",
    ],
    image: "assets/images/john_entwistle.jpg",
    audioFile: "assets/sound/the_who.mp3",
    band: "The Who",
},

{
    question: "",
    rightAnswer: "Stanley Clarke",
    allAnswers: [
        "Stanley Clarke",
        "Louis Johnson",
        "Rocco Prestia",
        "Howie Epstein",
    ],
    image: "assets/images/stanley_clarke.jpg",
    audioFile: "assets/sound/stanley_clarke.mp3",
    band: "Solo",
},

{
    question: "",
    rightAnswer: "Leland Sklar",
    allAnswers: [
        "Leland Sklar",
        "Mike Watt",
        "Chuck Rainey",
        "Michael Anthony",
    ],
    image: "assets/images/leland_sklar.jpg",
    audioFile: "assets/sound/sklar.mp3",
    band: "Session Musician",
},

{
    question: "",
    rightAnswer: "Justin Chancellor",
    allAnswers: [
        "Justin Chancellor",
        "Duff McKagan",
        "Phil Lesh",
        "Marcus Miller",
    ],
    image: "assets/images/justin_chancellor.jpg",
    audioFile: "assets/sound/tool.mp3",
    band: "Tool",
},

{
    question: "",
    rightAnswer: "Brandon Howell",
    allAnswers: [
        "Brandon Howell",
        "Chris Wolstenholme",
        "Anthony Jackson",
        "Carlos Dengler",
    ],
    image: "assets/images/howell.jpg",
    audioFile: "assets/sound/howell.mp3",
    band: "Looking for a band. You need a bass player?",
},

]; // close questionArray

console.log(questionArray);
console.log(questionArray[2].wrongAnswer1);

// ------------------------------------------------
// base variables
// ------------------------------------------------

var questIndex; // will increment this after each question
var shuffledQuestions = []; // will be updated with each question to hold its shuffled answers
var finalCorrect = 0; // tally for each game
var finalWrong = 0; // tally for each game
var finalUnanswered = 0; // tally for each game
var printTimer; // realtime timer variable for use during each answer. gets reset with writeScreen()
var defaultQuesTime = 30; // default time (in seconds) for questions
var answerTime = 5000; // how long (in milliseconds) we want to show the answer before moving to next question
var realtimeInterval; // holds the setInterval for use in each question
var audio = new Audio("assets/sound/silence.mp3"); // holder for our mp3 clues
// ^^ going ahead and setting this to silence so writeScreen() has something to bind to.
var oldAudio;

// ------------------------------------------------
// randomizing functions
// ------------------------------------------------

// array shuffle function:

// https://gomakethings.com/how-to-shuffle-an-array-with-vanilla-js/
// /**
//  * Randomly shuffle an array
//  * https://stackoverflow.com/a/2450976/1293256
//  * @param  {Array} array The array to shuffle
//  * @return {String}      The first item in the shuffled array
//  */

var shuffle = function (array) {

	var currentIndex = array.length;
	var temporaryValue, randomIndex;

	// While there remain elements to shuffle...
	while (0 !== currentIndex) {
		// Pick a remaining element...
		randomIndex = Math.floor(Math.random() * currentIndex);
		currentIndex -= 1;

		// And swap it with the current element.
		temporaryValue = array[currentIndex];
		array[currentIndex] = array[randomIndex];
		array[randomIndex] = temporaryValue;
	}

	return array;

};

// ------------------------------------------------
// writeScreen function
// ------------------------------------------------

// Write everything for this question to the screen
// Then we'll use display block/none to change the view with timeout/correct/incorrect

var writeScreen = function () {

    oldAudio = audio; // drop our audio into a different variable so we can control it after the new question's audio file is bound to the audio variable
    
    // faux fade-out sequence. could probably have been done with an interval if I had more time to mess with it
    setTimeout(function(){oldAudio.volume = 0.95;console.log("volume dropped");},100);
    setTimeout(function(){oldAudio.volume = 0.9;console.log("volume dropped");},200);
    setTimeout(function(){oldAudio.volume = 0.85;console.log("volume dropped");},300);
    setTimeout(function(){oldAudio.volume = 0.8;console.log("volume dropped");},400);
    setTimeout(function(){oldAudio.volume = 0.75;console.log("volume dropped");},500);
    setTimeout(function(){oldAudio.volume = 0.7;console.log("volume dropped");},600);
    setTimeout(function(){oldAudio.volume = 0.65;console.log("volume dropped");},700);
    setTimeout(function(){oldAudio.volume = 0.6;console.log("volume dropped");},800);
    setTimeout(function(){oldAudio.volume = 0.55;console.log("volume dropped");},900);
    setTimeout(function(){oldAudio.volume = 0.5;console.log("volume dropped");},1000);
    setTimeout(function(){oldAudio.volume = 0.45;console.log("volume dropped");},1100);
    setTimeout(function(){oldAudio.volume = 0.4;console.log("volume dropped");},1200);
    setTimeout(function(){oldAudio.volume = 0.35;console.log("volume dropped");},1300);
    setTimeout(function(){oldAudio.volume = 0.3;console.log("volume dropped");},1400);
    setTimeout(function(){oldAudio.volume = 0.25;console.log("volume dropped");},1500);
    setTimeout(function(){oldAudio.volume = 0.2;console.log("volume dropped");},1600);
    setTimeout(function(){oldAudio.volume = 0.15;console.log("volume dropped");},1700);
    setTimeout(function(){oldAudio.volume = 0.1;console.log("volume dropped");},1800);
    setTimeout(function(){oldAudio.volume = 0.05;console.log("volume dropped");},1900);
    setTimeout(function(){oldAudio.pause();console.log("paused");},2000);

    console.log("writeScreen questIndex = " + questIndex);
    console.log(shuffledQuestions);

    // write the bass player image
    $(".playerImg").attr("src", shuffledQuestions[questIndex].Image);

    // write the answers
    $("#answersDiv").empty(); // clear the answersDiv first
    var liveAns = shuffle(shuffledQuestions[questIndex].allAnswers); // shuffle the answers to this question
    for (i=0;i<liveAns.length;i++) {
        var newP = $("<button>"); // create <p>
        newP.text(liveAns[i]);// drop question into <p>
        newP.addClass("answer btn btn-lg btn-block btn-dark"); // add the answer class so we can watch for the button click
        newP.attr("type","button");
        newP.attr("data-value",liveAns[i]); // add data value for answer check logic
        $("#answersDiv").append(newP);// drop <p> into #answersDiv
    }

    // write the hint
    var newHint = $("<button>");
        newHint.text("I need an audio hint!");
        newHint.addClass("hint btn btn-lg btn-block btn-success");
        $("#answersDiv").append(newHint);

    // select the audio file to play
    console.log(shuffledQuestions[questIndex].audioFile);
    audio = new Audio(shuffledQuestions[questIndex].audioFile);
    document.body.appendChild(audio);
    
    // write the stuff for the wrong/right/timeout messages
    $(".correctAns").text(shuffledQuestions[questIndex].rightAnswer); // push the correct answer to the div
    $(".playerImg").attr("src", shuffledQuestions[questIndex].image);// push the larger picture to the div
    $(".bandName").text(shuffledQuestions[questIndex].band); // push the band name to the divs

    // show question and answers divs
    $("#answersDiv").attr("style", "display:block"); 
    $("#questionDiv").attr("style", "display:block"); 

    // hide wrongDiv, rightDiv, timeoutDiv, stats
    $("#wrongDiv").attr("style", "display:none");
    $("#rightDiv").attr("style", "display:none");
    $("#timeoutDiv").attr("style", "display:none");
    $("#stats").attr("style", "display:none");

    // reset and start our internal/timer
    printTimer = defaultQuesTime; // reset printTimer variable to default
    $(".printTimer").text(printTimer); // write printTimer to screen
    realtimeInterval = setInterval(countDown,1000); // fire off the countdown function every second

}

// ------------------------------------------------
// showTimeout function - is called by countDown if printTimer === 0
// ------------------------------------------------

var showTimeout = function() {
        console.log("answer timeout");
        questIndex++; // increment questIndex
        finalUnanswered++; // increment unanswered counter
        $("#answersDiv").attr("style", "display:none"); // hide answers div
        $("#questionDiv").attr("style", "display:block"); // keep questions div up
        $("#timeoutDiv").attr("style", "display:block"); // show timeoutDiv
        // audio.pause(); // pause the audio if it had been started
        // create timeout until the jump to the next question:
        setTimeout(gameOverYet,answerTime);
}

// ------------------------------------------------
// countDown function for interval
// ------------------------------------------------

var countDown = function() {
    printTimer--; // decrement printTimer
    $(".printTimer").text(printTimer); // write printTimer to screen
    if (printTimer === 0) {
        clearInterval(realtimeInterval);
        showTimeout(); 
    }
}

// ------------------------------------------------
// function "start" for starting (and restarting) the game
// ------------------------------------------------

var start = function() {

    console.log("start click captured");

    // set timer to sta

    // reset the right/wrong/unanswered counters
    finalCorrect = 0;
    finalWrong = 0;
    finalUnanswered = 0;

    questIndex = 0; // set to first question
    console.log(questIndex);

    // Update the shuffledQuestions array with the question's answers (and shuffle them, obviously)
    shuffledQuestions = shuffle(questionArray.slice()); // also pulled from https://gomakethings.com/how-to-shuffle-an-array-with-vanilla-js/
    console.log(shuffledQuestions);

    // Hide the start button
    $("#startDiv").attr("style", "display:none");

    // show time div
    $(".timeDiv").attr("style", "display:block");

    // send everything for the question to the DOM
    writeScreen();

};

// ------------------------------------------------
// function to decide if game is over (used in the timeout)
// ------------------------------------------------

var gameOverYet = function() {
    if (questIndex == shuffledQuestions.length) { // this comparison works because we increment questIndex after every answer, so for example, after answering the third question, the questIndex value is 3 (for the 4th, non-existent entry in the array)
        end();
    } else {
        writeScreen();
    }
}   

// ------------------------------------------------
// function "end" for showing final screen w/ scores
// ------------------------------------------------

var end = function() {

    console.log("end function");

    // hide question and answers divs
    $("#answersDiv").attr("style", "display:none"); 
    $("#questionDiv").attr("style", "display:none"); 

    // hide wrongDiv, rightDiv, timeoutDiv
    $("#wrongDiv").attr("style", "display:none");
    $("#rightDiv").attr("style", "display:none");
    $("#timeoutDiv").attr("style", "display:none");
    $(".timeDiv").attr("style", "display:none");

    // load up the stats div

    $("#finalCorrect").text(finalCorrect);
    $("#finalWrong").text(finalWrong);
    $("#finalUnanswered").text(finalUnanswered);

    // display stats div
    $("#stats").attr("style", "display:block");

    // 

};

// ------------------------------------------------
// call "start" when a .startButton is pressed
// ------------------------------------------------

// watch for the start button click event
$(document).on("click", ".startButton", function() { // watch for the click from start or restart

    start();

});

// ------------------------------------------------
// Watch for the answer click and execute logic
// ------------------------------------------------

$(document).on("click", ".answer", function() { // watch for the click


    // increment our question:
    
    console.log("questIndex = " + questIndex);
    console.log(shuffledQuestions[questIndex].rightAnswer);

    // capture the answer for this function
    var tempAns = $(this).attr("data-value");
    console.log(tempAns);

    $("#answersDiv").attr("style", "display:none"); // hide answers div
    $("#questionDiv").attr("style", "display:block"); // keep questions div up

    // if tempAns = right answer, then do this
    if (tempAns == shuffledQuestions[questIndex].rightAnswer) {
        console.log("right answer!");
        finalCorrect++;
        $("#rightDiv").attr("style", "display:block"); // show hidden #rightDiv
    // else if tempAns = wrong answer, then do this
    } else {
        console.log("wrong answer");
        finalWrong++;
        $("#wrongDiv").attr("style", "display:block"); // show hidden #wrongDiv
    }

    questIndex++; // otherwise increment the question index

    clearInterval(realtimeInterval); // stop the timer

    // create timeout until the jump to the next question
    setTimeout(gameOverYet,answerTime);

    // pause the audio if it had been started
    // audio.pause();

});

// ------------------------------------------------
// watch for the hint click
// ------------------------------------------------

$(document).on("click", ".hint", function() { // watch for the click
    console.log("hint click");
    audio.play();

});

